.PHONY: intfiles

all: intfiles
	+$(MAKE) -C .. rebuild

INTFILES=\
	FStar_Int8.ml		\
	FStar_Int16.ml		\
	FStar_Int32.ml		\
	FStar_Int64.ml		\
	FStar_UInt16.ml		\
	FStar_UInt32.ml		\
	FStar_UInt64.ml

intfiles: $(INTFILES)

%.ml: %.ml.prefix FStar_Ints.ml.body
	>$@
	@echo '(* !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! *)' >> $@
	@echo '(* THIS IS AN AUTOGENERATED FILE! See ulib/ml/Makefile *)' >> $@
	@echo '(* !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! *)' >> $@
	@echo '' >> $@
	@cat $< FStar_Ints.ml.body >> $@

clean:
	+$(MAKE) -C .. clean_ocaml

ML_NOT_IN_BASE=\
	FStar_Buffer.ml \
	FStar_Constructive.ml \
	FStar_HyperStack_ST.ml \
	FStar_Tcp.ml \
	FStar_Udp.ml \


.PHONY: dune-base-snapshot
dune-base-snapshot: $(INTFILES)
	mkdir -p $(DUNE_SNAPSHOT)/fstar-lib/generated
	cp $(INTFILES) $(DUNE_SNAPSHOT)/fstar-lib/generated
	cp $(filter-out $(INTFILES) $(ML_NOT_IN_BASE),$(wildcard *.ml *.mli)) $(DUNE_SNAPSHOT)/fstar-lib

.PHONY: clean-intfiles
clean-intfiles:
	rm -rf $(INTFILES)

.PHONY: dune-handwritten-snapshot
dune-handwritten-snapshot: $(ML_NOT_IN_BASE)
	cp $(ML_NOT_IN_BASE) $(DUNE_SNAPSHOT)/fstar-lib
