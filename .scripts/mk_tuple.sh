#!/bin/bash

set -eu

usage () {
        echo "Usage: $0 <true|false> <arity>" >&2
        exit 1
}

if [ $# -ne 2 ]; then
  usage
fi

if ! [ "$1" = "true" ] && ! [ "$1" = "false" ]; then
  usage
fi

dep=$1
arity=$2

if $dep; then
  Tuple=DTuple$arity
  tuple=dtuple$arity
else
  Tuple=Tuple$arity
  tuple=tuple$arity
fi


cat $(dirname $0)/copyright.txt
echo "module FStar.$Tuple"
echo "(* Autogenerated by mk_tuple.sh *)"
echo
if $dep; then echo "unopteq"; fi
echo "type t"
acc=
app=
for i in $(seq 1 $arity); do
  echo "  (t$i : (${acc}Type))"
  if $dep; then
    acc="${acc}x$i : t$i$app -> "
    app="$app x$i"
  fi
done
echo "= | Mk :"
acc=
for i in $(seq 1 $arity); do
    echo "      _$i : t$i$acc ->"
    if $dep; then acc="$acc _$i"; fi
done
    echo -n "      t"; for i in $(seq 1 $arity); do echo -n " t$i"; done
echo
echo
echo "let $tuple = t"
